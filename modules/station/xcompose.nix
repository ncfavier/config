{ inputs, lib, pkgs, ... }: with lib; let
  series = f: from: to: listToAttrs (zipListsWith nameValuePair (map f from) to);
  digitChars = stringToCharacters "0123456789";

  compose.keysyms = {
    "â‹†" = "Multi_key";
    "â€¸" = "dead_circumflex";
    "Âµ" = "dead_greek";
    "â†’" = "Right";
    "â†" = "Left";
    "â†‘" = "Up";
    "â†“" = "Down";
    "â‡¥" = "Tab";
    "â†µ" = "Return";
  };

  compose.entries =
    series (x: "â‹†C${x}") upperChars [ "ğ’œ" "â„¬" "ğ’" "ğ’Ÿ" "â„°" "â„±" "ğ’¢" "â„‹" "â„" "ğ’¥" "ğ’¦" "â„’" "â„³" "ğ’©" "ğ’ª" "ğ’«" "ğ’¬" "â„›" "ğ’®" "ğ’¯" "ğ’°" "ğ’±" "ğ’²" "ğ’³" "ğ’´" "ğ’µ" ] //
    series (x: "â‹†B${x}") upperChars [ "ğ”¸" "ğ”¹" "â„‚" "ğ”»" "ğ”¼" "ğ”½" "ğ”¾" "â„" "ğ•€" "ğ•" "ğ•‚" "ğ•ƒ" "ğ•„" "â„•" "ğ•†" "â„™" "â„š" "â„" "ğ•Š" "ğ•‹" "ğ•Œ" "ğ•" "ğ•" "ğ•" "ğ•" "â„¤" ] //
    series (x: "â‹†B${x}") lowerChars [ "ğ•’" "ğ•“" "ğ•”" "ğ••" "ğ•–" "ğ•—" "ğ•˜" "ğ•™" "ğ•š" "ğ•›" "ğ•œ" "ğ•" "ğ•" "ğ•Ÿ" "ğ• " "ğ•¡" "ğ•¢" "ğ•£" "ğ•¤" "ğ•¥" "ğ•¦" "ğ•§" "ğ•¨" "ğ•©" "ğ•ª" "ğ•«" ] //
    series (x: "â‹†B${x}") digitChars [ "ğŸ˜" "ğŸ™" "ğŸš" "ğŸ›" "ğŸœ" "ğŸ" "ğŸ" "ğŸŸ" "ğŸ " "ğŸ¡" ] //
    series (x: "â‹†b${x}") upperChars [ "ğ€" "ğ" "ğ‚" "ğƒ" "ğ„" "ğ…" "ğ†" "ğ‡" "ğˆ" "ğ‰" "ğŠ" "ğ‹" "ğŒ" "ğ" "ğ" "ğ" "ğ" "ğ‘" "ğ’" "ğ“" "ğ”" "ğ•" "ğ–" "ğ—" "ğ˜" "ğ™" ] //
    series (x: "â‹†b${x}") lowerChars [ "ğš" "ğ›" "ğœ" "ğ" "ğ" "ğŸ" "ğ " "ğ¡" "ğ¢" "ğ£" "ğ¤" "ğ¥" "ğ¦" "ğ§" "ğ¨" "ğ©" "ğª" "ğ«" "ğ¬" "ğ­" "ğ®" "ğ¯" "ğ°" "ğ±" "ğ²" "ğ³" ] //
    series (x: "â‹†b${x}") digitChars [ "ğŸ" "ğŸ" "ğŸ" "ğŸ‘" "ğŸ’" "ğŸ“" "ğŸ”" "ğŸ•" "ğŸ–" "ğŸ—" ] //
    series (x: "â‹†f${x}") upperChars [ "ğ”„" "ğ”…" "â„­" "ğ”‡" "ğ”ˆ" "ğ”‰" "ğ”Š" "â„Œ" "â„‘" "ğ”" "ğ”" "ğ”" "ğ”" "ğ”‘" "ğ”’" "ğ”“" "ğ””" "â„œ" "ğ”–" "ğ”—" "ğ”˜" "ğ”™" "ğ”š" "ğ”›" "ğ”œ" "â„¨" ] //
    series (x: "â‹†f${x}") lowerChars [ "ğ”" "ğ”Ÿ" "ğ” " "ğ”¡" "ğ”¢" "ğ”£" "ğ”¤" "ğ”¥" "ğ”¦" "ğ”§" "ğ”¨" "ğ”©" "ğ”ª" "ğ”«" "ğ”¬" "ğ”­" "ğ”®" "ğ”¯" "ğ”°" "ğ”±" "ğ”²" "ğ”³" "ğ”´" "ğ”µ" "ğ”¶" "ğ”·" ] //
    series (x: "â‹†F${x}") upperChars [ "ğ•¬" "ğ•­" "ğ•®" "ğ•¯" "ğ•°" "ğ•±" "ğ•²" "ğ•³" "ğ•´" "ğ•µ" "ğ•¶" "ğ•·" "ğ•¸" "ğ•¹" "ğ•º" "ğ•»" "ğ•¼" "ğ•½" "ğ•¾" "ğ•¿" "ğ–€" "ğ–" "ğ–‚" "ğ–ƒ" "ğ–„" "ğ–…" ] //
    series (x: "â‹†F${x}") lowerChars [ "ğ–†" "ğ–‡" "ğ–ˆ" "ğ–‰" "ğ–Š" "ğ–‹" "ğ–Œ" "ğ–" "ğ–" "ğ–" "ğ–" "ğ–‘" "ğ–’" "ğ–“" "ğ–”" "ğ–•" "ğ––" "ğ–—" "ğ–˜" "ğ–™" "ğ–š" "ğ–›" "ğ–œ" "ğ–" "ğ–" "ğ–Ÿ" ] //
    series (x: "â‹†_${x}") (stringToCharacters "acehijklmnoprstuvx") [ "â‚" "ğ" "â‚‘" "â‚•" "áµ¢" "â±¼" "â‚–" "â‚—" "â‚˜" "â‚™" "â‚’" "â‚š" "áµ£" "â‚›" "â‚œ" "áµ¤" "áµ¥" "â‚“" ] //
  {
    "â‹†en" = "â€“";
    "â‹†<|s" = "â—‚";
    "â‹†|>s" = "â–¸";
    "â‹†|>w" = "â–¹";
    "â‹†<|b" = "â—€";
    "â‹†|>b" = "â–¶";
    "â‹†box" = "â–¡";
    "â‹†|â†’" = "â†¦";
    "â‹†qed" = "âˆ";
    "â‹†oo" = "âˆ˜";
    "â‹†**" = "â‹†";
    "â‹†ast" = "âˆ—";
    "â‹†*." = "âˆ™";
    "â‹†*," = "Â·";
    "â‹†*o" = "âˆ˜";
    "â‹†<*>" = "âŠ›";
    "â‹†Ã—|" = "â‹Š";
    "â‹†x|" = "â‹Š";
    "â‹†|Ã—" = "â‹‰";
    "â‹†|x" = "â‹‰";
    "â‹†wr" = "â‰€";
    "â‹†:=" = "â‰”";
    "â‹†==" = "â‰¡";
    "â‹†=3" = "â‰¡";
    "â‹†=/=" = "â‰¢";
    "â‹†=/3" = "â‰¢";
    "â‹†=4" = "â‰£";
    "â‹†~=" = "â‰ƒ";
    "â‹†=~" = "â‰…";
    "â‹†~~" = "â‰ˆ";
    "â‹†?=" = "â‰Ÿ";
    "â‹†.=" = "â‰";
    "â‹†=." = "â‰";
    "â‹†<(" = "âŸ¨";
    "â‹†>)" = "âŸ©";
    "â‹†(<" = "âŸ¨";
    "â‹†)>" = "âŸ©";
    "â‹†(|" = "â¦‡";
    "â‹†|)" = "â¦ˆ";
    "â‹†[|" = "âŸ¦";
    "â‹†|]" = "âŸ§";
    "â‹†{|" = "â¦ƒ";
    "â‹†|}" = "â¦„";
    "â‹†_[" = "âŒ";
    "â‹†[_" = "âŒ";
    "â‹†_]" = "âŒŸ";
    "â‹†]_" = "âŒŸ";
    "â‹†()" = "â‰¬";
    "â‹†<<" = "â‰ª";
    "â‹†>>" = "â‰«";
    "â‹†mid" = "âˆ£";
    "â‹†||" = "âˆ¥";
    "â‹†/\\" = "âˆ§";
    "â‹†land" = "âˆ§";
    "â‹†lor" = "âˆ¨";
    "â‹†iff" = "â‡”";
    "â‹†top" = "âŠ¤";
    "â‹†bot" = "âŠ¥";
    "â‹†_|_" = "âŠ¥";
    "â‹†ex" = "âˆƒ";
    "â‹†/ex" = "âˆ„";
    "â‹†all" = "âˆ€";
    "â‹†|-" = "âŠ¢";
    "â‹†2|-" = "âŠ©";
    "â‹†-|" = "âŠ£";
    "â‹†|=" = "âŠ¨";
    "â‹†mem" = "âˆˆ";
    "â‹†nmem" = "âˆ‰";
    "â‹†inc" = "âŠ‚";
    "â‹†cni" = "âŠƒ";
    "â‹†ninc" = "âŠ„";
    "â‹†/inc" = "âŠ„";
    "â‹†=inc" = "âŠ†";
    "â‹†=cni" = "âŠ‡";
    "â‹†cup" = "âˆª";
    "â‹†cap" = "âˆ©";
    "â‹†sqcup" = "âŠ”";
    "â‹†sqcap" = "âŠ“";
    "â‹†u+" = "âŠ";
    "â‹†U+" = "âŠ";
    "â‹†/0" = "âˆ…";
    "â‹†inf" = "âˆ";
    "â‹†aleph" = "â„µ";
    "â‹†alef" = "â„µ";
    "â‹†o*" = "âŠ—";
    "â‹†o+" = "âŠ•";
    "â‹†o." = "âŠ™";
    "â‹†&&" = "â…‹";
    "â‹†par" = "â…‹";
    "â‹†-o" = "âŠ¸";
    "â‹†sqrt" = "âˆš";
    "â‹†3sq" = "âˆ›";
    "â‹†4sq" = "âˆœ";
    "â‹†int" = "âˆ«";
    "â‹†1/4" = "Â¼";
    "â‹†1/2" = "Â½";
    "â‹†3/4" = "Â¾";
    "â‹†1/3" = "â…“";
    "â‹†2/3" = "â…”";
    "â‹†1/5" = "â…•";
    "â‹†2/5" = "â…–";
    "â‹†3/5" = "â…—";
    "â‹†4/5" = "â…˜";
    "â‹†1/6" = "â…™";
    "â‹†5/6" = "â…š";
    "â‹†1/8" = "â…›";
    "â‹†3/8" = "â…œ";
    "â‹†5/8" = "â…";
    "â‹†7/8" = "â…";
    "Âµ/l" = "Æ›";
    "â‹†^a" = "áµƒ";
    "â‹†^A" = "á´¬";
    "â€¸b" = "áµ‡";
    "â€¸B" = "á´®";
    "â€¸c" = "á¶œ";
    "â€¸C" = "êŸ²";
    "â€¸d" = "áµˆ";
    "â€¸D" = "á´°";
    "â‹†^e" = "áµ‰";
    "â‹†^E" = "á´±";
    "â€¸f" = "á¶ ";
    "â€¸F" = "êŸ³";
    "â€¸g" = "áµ";
    "â€¸G" = "á´³";
    "â€¸h" = "Ê°";
    "â€¸H" = "á´´";
    "â‹†^i" = "â±";
    "â‹†^I" = "á´µ";
    "â‹†^j" = "Ê²";
    "â‹†^J" = "á´¶";
    "â€¸k" = "áµ";
    "â€¸K" = "á´·";
    "â€¸l" = "Ë¡";
    "â€¸L" = "á´¸";
    "â€¸m" = "áµ";
    "â€¸M" = "á´¹";
    "â€¸n" = "â¿";
    "â€¸N" = "á´º";
    "â‹†^o" = "áµ’";
    "â‹†^O" = "á´¼";
    "â€¸p" = "áµ–";
    "â€¸P" = "á´¾";
    "â€¸q" = "ğ¥";
    "â€¸Q" = "êŸ´";
    "â€¸r" = "Ê³";
    "â€¸R" = "á´¿";
    "â€¸s" = "Ë¢";
    "â€¸t" = "áµ—";
    "â€¸T" = "áµ€";
    "â‹†^u" = "áµ˜";
    "â‹†^U" = "áµ";
    "â€¸v" = "áµ›";
    "â€¸V" = "â±½";
    "â€¸w" = "Ê·";
    "â€¸W" = "áµ‚";
    "â€¸x" = "Ë£";
    "â‹†^y" = "Ê¸";
    "â€¸z" = "á¶»";
    "â€¸'" = "â€²";
    "â€¸\"" = "â€³";
    "â‹†b~" = "âˆ¼";
    "â‹†el" = "â„“";
    "â‹†dee" = "âˆ‚";
    "â‹†nab" = "âˆ‡";
    "â‹†yo" = "ã‚ˆ";
    "â‹†\"o" = "Å‘";
    "â‹†\"O" = "Å";
    "â‹†  " = "â£";
    "â‹†â†‘" = "â†‘";
    "â‹†â†“" = "â†“";
    "â‹†â†" = "â†";
    "â‹†â†’" = "â†’";
    "â‹†sw" = "â†™";
    "â‹†se" = "â†˜";
    "â‹†nw" = "â†–";
    "â‹†ne" = "â†—";
    "â‹†lr" = "â†”";
    "â‹†ud" = "â†•";
    "â‹†(â†’" = "â†ª";
    "â‹†-/>" = "â†›";
    "â‹†</-" = "â†š";
    "â‹†2â†" = "â‡‡";
    "â‹†2â†’" = "â‡‰";
    "â‹†3â†’" = "â‡¶";
    "â‹†lâ†’" = "âŸ¶";
    "â‹†lâ†" = "âŸµ";
    "â‹†=â†‘" = "â‡‘";
    "â‹†l=>" = "âŸ¹";
    "â‹†l=<" = "âŸ¸";
    "â‹†â‡¥" = "â‡¥";
    "â‹†â†µ" = "â†µ";
    "â‹†fl" = "â§";
    "â‹†ok" = "âœ“";
    "â‹†nok" = "âœ—";
    "â‹†zap" = "â†¯";
    "â‹†1." = "â’ˆ";
    "â‹†2." = "â’‰";
    "â‹†3." = "â’Š";
    "â‹†4." = "â’‹";
    "â‹†5." = "â’Œ";
    "â‹†6." = "â’";
    "â‹†7." = "â’";
    "â‹†8." = "â’";
    "â‹†9." = "â’";
    "â‹†10." = "â’‘";
    "â‹†fll" = "âŒŠ";
    "â‹†flr" = "âŒ‹";
    "â‹†cel" = "âŒˆ";
    "â‹†cer" = "âŒ‰";
    "â€¸[" = "âŒœ";
    "â€¸]" = "âŒ";
    "â‹†2!" = "â€¼";
    "â‹†2?" = "â‡";
    "â‹†zw" = "â€‹";
    "â‹†znj" = "";
    "â‹†zwj" = "";
    "â‹†wj" = "â ";
    "â‹†.|." = "â‹®";
    "â‹†+|" = "â€ ";
    "â‹†++" = "â€¡";
    "â‹†st" = "ï¬†";
    "â‹†ft" = "ï¬…";
    "â‹†_-" = "â‚‹";
    "â‹†::" = "âˆ·";
    "â‹†#G" = "ğ„";
    "â‹†#F" = "ğ„¢";
    "â‹†#C" = "ğ„¡";
    "â‹†Â°C" = "â„ƒ";
    "â‹†Â°F" = "â„‰";
    "â‹†mu" = "ç„¡";
    "â‹†om" = "à¥";
    "â‹†et" = "ê«";
    "â‹†ET" = "êª";
    "â‹†sh" = "Êƒ";
    "â‹†cube" = "ğŸ§Š";
    "â‹†OO" = "ğŸ‘€";
    "â‹†><" = "ğŸ‘‰ğŸ‘ˆ";
    "â‹†lem" = "https://f.monade.li/lemon.webp";
    "â‹†sus" = "à¶";
    "â‹†\\/" = "Â¯\\_(ãƒ„)_/Â¯";
    "â‹†2\\/" = "â”('~'; )â”Œ";
    "â‹†len" = "( Í¡Â° ÍœÊ– Í¡Â°)";
    "â‹†meh" = "à² _à² ";
    "â‹†tf" = "(â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»";
    "â‹†qt" = "(â—•â€¿â—•)";
    "â‹†sad" = "(ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)";
    "â‹†sry" = "('''' â€¢á·„ á´— â€¢á·… )";
  };

  composeFile = pkgs.runCommand "custom.compose" {
    nativeBuildInputs = [ inputs.agda-compose.packages.x86_64-linux.json2compose ];
  } ''
    json2compose < ${builtins.toFile "compose.json" (builtins.toJSON compose)} > "$out"
  '';
in {
  hm.home.file.".XCompose" = {
    text = ''
      include "%L"
      include "${inputs.agda-compose.packages.x86_64-linux.agda-compose}"
      include "${composeFile}"
    '';

    onChange = ''
      ${getBin pkgs.ibus}/bin/ibus restart || true
    '';
  };
}
