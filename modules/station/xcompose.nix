{ inputs, lib, pkgs, ... }: with lib; let
  series = f: from: to: listToAttrs (zipListsWith nameValuePair (map f from) to);
  digitChars = stringToCharacters "0123456789";

  compose =
    series (x: "C${x}") upperChars [ "ğ’œ" "â„¬" "ğ’" "ğ’Ÿ" "â„°" "â„±" "ğ’¢" "â„‹" "â„" "ğ’¥" "ğ’¦" "â„’" "â„³" "ğ’©" "ğ’ª" "ğ’«" "ğ’¬" "â„›" "ğ’®" "ğ’¯" "ğ’°" "ğ’±" "ğ’²" "ğ’³" "ğ’´" "ğ’µ" ] //
    series (x: "B${x}") upperChars [ "ğ”¸" "ğ”¹" "â„‚" "ğ”»" "ğ”¼" "ğ”½" "ğ”¾" "â„" "ğ•€" "ğ•" "ğ•‚" "ğ•ƒ" "ğ•„" "â„•" "ğ•†" "â„™" "â„š" "â„" "ğ•Š" "ğ•‹" "ğ•Œ" "ğ•" "ğ•" "ğ•" "ğ•" "â„¤" ] //
    series (x: "B${x}") lowerChars [ "ğ•’" "ğ•“" "ğ•”" "ğ••" "ğ•–" "ğ•—" "ğ•˜" "ğ•™" "ğ•š" "ğ•›" "ğ•œ" "ğ•" "ğ•" "ğ•Ÿ" "ğ• " "ğ•¡" "ğ•¢" "ğ•£" "ğ•¤" "ğ•¥" "ğ•¦" "ğ•§" "ğ•¨" "ğ•©" "ğ•ª" "ğ•«" ] //
    series (x: "B${x}") digitChars [ "ğŸ˜" "ğŸ™" "ğŸš" "ğŸ›" "ğŸœ" "ğŸ" "ğŸ" "ğŸŸ" "ğŸ " "ğŸ¡" ] //
    series (x: "b${x}") upperChars [ "ğ€" "ğ" "ğ‚" "ğƒ" "ğ„" "ğ…" "ğ†" "ğ‡" "ğˆ" "ğ‰" "ğŠ" "ğ‹" "ğŒ" "ğ" "ğ" "ğ" "ğ" "ğ‘" "ğ’" "ğ“" "ğ”" "ğ•" "ğ–" "ğ—" "ğ˜" "ğ™" ] //
    series (x: "b${x}") lowerChars [ "ğš" "ğ›" "ğœ" "ğ" "ğ" "ğŸ" "ğ " "ğ¡" "ğ¢" "ğ£" "ğ¤" "ğ¥" "ğ¦" "ğ§" "ğ¨" "ğ©" "ğª" "ğ«" "ğ¬" "ğ­" "ğ®" "ğ¯" "ğ°" "ğ±" "ğ²" "ğ³" ] //
    series (x: "b${x}") digitChars [ "ğŸ" "ğŸ" "ğŸ" "ğŸ‘" "ğŸ’" "ğŸ“" "ğŸ”" "ğŸ•" "ğŸ–" "ğŸ—" ] //
    series (x: "f${x}") upperChars [ "ğ”„" "ğ”…" "â„­" "ğ”‡" "ğ”ˆ" "ğ”‰" "ğ”Š" "â„Œ" "â„‘" "ğ”" "ğ”" "ğ”" "ğ”" "ğ”‘" "ğ”’" "ğ”“" "ğ””" "â„œ" "ğ”–" "ğ”—" "ğ”˜" "ğ”™" "ğ”š" "ğ”›" "ğ”œ" "â„¨" ] //
    series (x: "f${x}") lowerChars [ "ğ”" "ğ”Ÿ" "ğ” " "ğ”¡" "ğ”¢" "ğ”£" "ğ”¤" "ğ”¥" "ğ”¦" "ğ”§" "ğ”¨" "ğ”©" "ğ”ª" "ğ”«" "ğ”¬" "ğ”­" "ğ”®" "ğ”¯" "ğ”°" "ğ”±" "ğ”²" "ğ”³" "ğ”´" "ğ”µ" "ğ”¶" "ğ”·" ] //
    series (x: "F${x}") upperChars [ "ğ•¬" "ğ•­" "ğ•®" "ğ•¯" "ğ•°" "ğ•±" "ğ•²" "ğ•³" "ğ•´" "ğ•µ" "ğ•¶" "ğ•·" "ğ•¸" "ğ•¹" "ğ•º" "ğ•»" "ğ•¼" "ğ•½" "ğ•¾" "ğ•¿" "ğ–€" "ğ–" "ğ–‚" "ğ–ƒ" "ğ–„" "ğ–…" ] //
    series (x: "F${x}") lowerChars [ "ğ–†" "ğ–‡" "ğ–ˆ" "ğ–‰" "ğ–Š" "ğ–‹" "ğ–Œ" "ğ–" "ğ–" "ğ–" "ğ–" "ğ–‘" "ğ–’" "ğ–“" "ğ–”" "ğ–•" "ğ––" "ğ–—" "ğ–˜" "ğ–™" "ğ–š" "ğ–›" "ğ–œ" "ğ–" "ğ–" "ğ–Ÿ" ] //
    series (x: "_${x}") (stringToCharacters "acehijklmnoprstuvx") [ "â‚" "ğ" "â‚‘" "â‚•" "áµ¢" "â±¼" "â‚–" "â‚—" "â‚˜" "â‚™" "â‚’" "â‚š" "áµ£" "â‚›" "â‚œ" "áµ¤" "áµ¥" "â‚“" ] //
  {
    "en" = "â€“";
    "<|s" = "â—‚";
    "|>s" = "â–¸";
    "|>w" = "â–¹";
    "<|b" = "â—€";
    "|>b" = "â–¶";
    "box" = "â–¡";
    "|â†’" = "â†¦";
    "qed" = "âˆ";
    "oo" = "âˆ˜";
    "**" = "â‹†";
    "ast" = "âˆ—";
    "*." = "âˆ™";
    "*," = "Â·";
    "*o" = "âˆ˜";
    "<*>" = "âŠ›";
    "Ã—|" = "â‹Š";
    "x|" = "â‹Š";
    "|Ã—" = "â‹‰";
    "|x" = "â‹‰";
    "wr" = "â‰€";
    ":=" = "â‰”";
    "==" = "â‰¡";
    "=3" = "â‰¡";
    "=/=" = "â‰¢";
    "=/3" = "â‰¢";
    "=4" = "â‰£";
    "~=" = "â‰ƒ";
    "=~" = "â‰…";
    "~~" = "â‰ˆ";
    "?=" = "â‰Ÿ";
    ".=" = "â‰";
    "=." = "â‰";
    "<(" = "âŸ¨";
    ">)" = "âŸ©";
    "(<" = "âŸ¨";
    ")>" = "âŸ©";
    "(|" = "â¦‡";
    "|)" = "â¦ˆ";
    "[|" = "âŸ¦";
    "|]" = "âŸ§";
    "{|" = "â¦ƒ";
    "|}" = "â¦„";
    "_[" = "âŒ";
    "[_" = "âŒ";
    "_]" = "âŒŸ";
    "]_" = "âŒŸ";
    "()" = "â‰¬";
    "<<" = "â‰ª";
    ">>" = "â‰«";
    "mid" = "âˆ£";
    "||" = "âˆ¥";
    "/\\" = "âˆ§";
    "land" = "âˆ§";
    "lor" = "âˆ¨";
    "iff" = "â‡”";
    "top" = "âŠ¤";
    "bot" = "âŠ¥";
    "_|_" = "âŠ¥";
    "ex" = "âˆƒ";
    "/ex" = "âˆ„";
    "all" = "âˆ€";
    "|-" = "âŠ¢";
    "2|-" = "âŠ©";
    "-|" = "âŠ£";
    "|=" = "âŠ¨";
    "mem" = "âˆˆ";
    "nmem" = "âˆ‰";
    "inc" = "âŠ‚";
    "cni" = "âŠƒ";
    "ninc" = "âŠ„";
    "/inc" = "âŠ„";
    "=inc" = "âŠ†";
    "=cni" = "âŠ‡";
    "cup" = "âˆª";
    "cap" = "âˆ©";
    "sqcup" = "âŠ”";
    "sqcap" = "âŠ“";
    "u+" = "âŠ";
    "U+" = "âŠ";
    "/0" = "âˆ…";
    "inf" = "âˆ";
    "aleph" = "â„µ";
    "alef" = "â„µ";
    "o*" = "âŠ—";
    "o+" = "âŠ•";
    "o." = "âŠ™";
    "&&" = "â…‹";
    "par" = "â…‹";
    "-o" = "âŠ¸";
    "sqrt" = "âˆš";
    "3sq" = "âˆ›";
    "4sq" = "âˆœ";
    "int" = "âˆ«";
    "1/4" = "Â¼";
    "1/2" = "Â½";
    "3/4" = "Â¾";
    "1/3" = "â…“";
    "2/3" = "â…”";
    "1/5" = "â…•";
    "2/5" = "â…–";
    "3/5" = "â…—";
    "4/5" = "â…˜";
    "1/6" = "â…™";
    "5/6" = "â…š";
    "1/8" = "â…›";
    "3/8" = "â…œ";
    "5/8" = "â…";
    "7/8" = "â…";
    "<dead_greek>/l" = "Æ›";
    "^a" = "áµƒ";
    "^A" = "á´¬";
    "<dead_circumflex>b" = "áµ‡";
    "<dead_circumflex>B" = "á´®";
    "<dead_circumflex>c" = "á¶œ";
    "<dead_circumflex>C" = "êŸ²";
    "<dead_circumflex>d" = "áµˆ";
    "<dead_circumflex>D" = "á´°";
    "^e" = "áµ‰";
    "^E" = "á´±";
    "<dead_circumflex>f" = "á¶ ";
    "<dead_circumflex>F" = "êŸ³";
    "<dead_circumflex>g" = "áµ";
    "<dead_circumflex>G" = "á´³";
    "<dead_circumflex>h" = "Ê°";
    "<dead_circumflex>H" = "á´´";
    "^i" = "â±";
    "^I" = "á´µ";
    "^j" = "Ê²";
    "^J" = "á´¶";
    "<dead_circumflex>k" = "áµ";
    "<dead_circumflex>K" = "á´·";
    "<dead_circumflex>l" = "Ë¡";
    "<dead_circumflex>L" = "á´¸";
    "<dead_circumflex>m" = "áµ";
    "<dead_circumflex>M" = "á´¹";
    "<dead_circumflex>n" = "â¿";
    "<dead_circumflex>N" = "á´º";
    "^o" = "áµ’";
    "^O" = "á´¼";
    "<dead_circumflex>p" = "áµ–";
    "<dead_circumflex>P" = "á´¾";
    "<dead_circumflex>q" = "ğ¥";
    "<dead_circumflex>Q" = "êŸ´";
    "<dead_circumflex>r" = "Ê³";
    "<dead_circumflex>R" = "á´¿";
    "<dead_circumflex>s" = "Ë¢";
    "<dead_circumflex>t" = "áµ—";
    "<dead_circumflex>T" = "áµ€";
    "^u" = "áµ˜";
    "^U" = "áµ";
    "<dead_circumflex>v" = "áµ›";
    "<dead_circumflex>V" = "â±½";
    "<dead_circumflex>w" = "Ê·";
    "<dead_circumflex>W" = "áµ‚";
    "<dead_circumflex>x" = "Ë£";
    "^y" = "Ê¸";
    "<dead_circumflex>z" = "á¶»";
    "<dead_circumflex>'" = "â€²";
    "<dead_circumflex>\"" = "â€³";
    "b~" = "âˆ¼";
    "el" = "â„“";
    "dee" = "âˆ‚";
    "nab" = "âˆ‡";
    "yo" = "ã‚ˆ";
    "\"o" = "Å‘";
    "\"O" = "Å";
    "  " = "â£";
    "âŒ«" = "âŒ«";
    "â†‘" = "â†‘";
    "â†“" = "â†“";
    "â†" = "â†";
    "â†’" = "â†’";
    "sw" = "â†™";
    "se" = "â†˜";
    "nw" = "â†–";
    "ne" = "â†—";
    "lr" = "â†”";
    "ud" = "â†•";
    "(â†’" = "â†ª";
    "-/>" = "â†›";
    "</-" = "â†š";
    "2â†" = "â‡‡";
    "2â†’" = "â‡‰";
    "3â†’" = "â‡¶";
    "lâ†’" = "âŸ¶";
    "lâ†" = "âŸµ";
    "=â†‘" = "â‡‘";
    "l=>" = "âŸ¹";
    "l=<" = "âŸ¸";
    "â‡¥" = "â‡¥";
    "â†µ" = "â†µ";
    "fl" = "â§";
    "ok" = "âœ“";
    "nok" = "âœ—";
    "zap" = "â†¯";
    "1." = "â’ˆ";
    "2." = "â’‰";
    "3." = "â’Š";
    "4." = "â’‹";
    "5." = "â’Œ";
    "6." = "â’";
    "7." = "â’";
    "8." = "â’";
    "9." = "â’";
    "10." = "â’‘";
    "fll" = "âŒŠ";
    "flr" = "âŒ‹";
    "cel" = "âŒˆ";
    "cer" = "âŒ‰";
    "<dead_circumflex>[" = "âŒœ";
    "<dead_circumflex>]" = "âŒ";
    "2!" = "â€¼";
    "2?" = "â‡";
    "zw" = "â€‹";
    "znj" = "";
    "zwj" = "";
    "wj" = "â ";
    ".|." = "â‹®";
    "+|" = "â€ ";
    "++" = "â€¡";
    "st" = "ï¬†";
    "ft" = "ï¬…";
    "_-" = "â‚‹";
    "::" = "âˆ·";
    "#G" = "ğ„";
    "#F" = "ğ„¢";
    "#C" = "ğ„¡";
    "Â°C" = "â„ƒ";
    "Â°F" = "â„‰";
    "mu" = "ç„¡";
    "om" = "à¥";
    "et" = "ê«";
    "ET" = "êª";
    "sh" = "Êƒ";
    "cube" = "ğŸ§Š";
    "OO" = "ğŸ‘€";
    "><" = "ğŸ‘‰ğŸ‘ˆ";
    "lem" = "https://f.monade.li/lemon.webp";
    "sus" = "à¶";
    "\\/" = "Â¯\\_(ãƒ„)_/Â¯";
    "2\\/" = "â”('~'; )â”Œ";
    "len" = "( Í¡Â° ÍœÊ– Í¡Â°)";
    "meh" = "à² _à² ";
    "tf" = "(â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»";
    "qt" = "(â—•â€¿â—•)";
    "sad" = "(ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)";
    "sry" = "('''' â€¢á·„ á´— â€¢á·… )";
  };

  composeFile = pkgs.runCommand "custom.compose" {
    nativeBuildInputs = [ inputs.agda-compose.packages.x86_64-linux.json2compose ];
  } ''
    json2compose < ${builtins.toFile "compose.json" (builtins.toJSON compose)} > "$out"
  '';
in {
  hm.home.file.".XCompose" = {
    text = ''
      include "%L"
      include "${inputs.agda-compose.packages.x86_64-linux.agda-compose}"
      include "${composeFile}"
    '';

    onChange = ''
      ${getBin pkgs.ibus}/bin/ibus restart || true
    '';
  };
}
